# PersLitRank 个性化文献检索系统框架描述

## 系统概述

PersLitRank是一个三阶段的个性化文献检索与重排系统，通过从用户查询历史中提取认知特征，生成个性化研究画像，并基于该画像对检索到的候选文档进行重排，从而提供更符合用户研究兴趣和背景的文献推荐结果。

## 核心设计理念

系统采用**仅基于个性化画像的重排策略**（Profile-Only Reranking），即重排阶段完全依赖生成的个性化研究画像，而不直接使用当前查询。这种设计使得系统能够：
- 更好地理解用户的长期研究兴趣和领域背景
- 在重排时综合考虑用户的研究轨迹，而不仅仅是当前查询的表面语义
- 提供更加个性化和上下文相关的文献推荐

---

## 阶段一：认知特征提取（Cognitive Feature Extraction）

### 功能描述
从用户的查询会话历史中提取三类认知特征，这些特征反映了用户在不同时间尺度上的研究关注点。

### 输入
- **查询会话（Query Session）**：包含当前查询和历史的查询序列
  - 当前查询（Current Query）：用户当前提出的查询
  - 历史查询（History Queries）：同一会话中的先前查询

### 处理流程

#### 1. 上下文特征蒸馏（Contextual Feature Distillation）
从查询会话中提取三种类型的认知线索：

**a) 序列线索（Sequential Cues）**
- **功能**：捕获对话中的时序依赖关系和话题连续性
- **提取方法**：分析查询序列中的关键词演变、术语一致性、引用解析（如"this"、"these"、"one...other"等指代关系）
- **表示**：关键词列表，标注为 `[SEQUENTIAL_MEMORY]`
- **示例**：如果Turn 1讨论"OCD and depression"，Turn 2查询"treating one condition over the other"，系统会识别出"one"指代OCD，"other"指代depression

**b) 焦点线索（Focus Cues）**
- **功能**：识别当前会话的主要关注领域
- **提取方法**：使用KeyBERT等关键词提取工具，结合工作记忆机制，提取当前会话的核心概念
- **表示**：当前会话的关键词和概念，标注为 `[WORKING_MEMORY]`
- **特点**：反映用户在当前对话中的即时研究焦点

**c) 背景线索（Background Cues）**
- **功能**：捕获用户的长期研究兴趣和领域背景
- **提取方法**：从所有历史查询中提取长期稳定的研究主题和领域术语
- **表示**：长期研究兴趣关键词，标注为 `[LONG_EXPLICIT]`
- **特点**：反映用户的研究领域、专业背景和持续关注的主题

### 输出
- **标注的认知特征列表（Tagged Memory Features）**：
  - `[SEQUENTIAL_MEMORY]`: 序列记忆特征（关键词列表）
  - `[WORKING_MEMORY]`: 工作记忆特征（当前焦点）
  - `[LONG_EXPLICIT]`: 长期显式记忆特征（研究背景）

---

## 阶段二：个性化画像生成（Personalized Profile Generation）

### 功能描述
使用大语言模型（LLM）将提取的认知特征整合成一段简洁、连贯的个性化研究背景描述，该描述将作为重排阶段的唯一输入。

### 输入
- **当前查询（Current Query）**：用户当前提出的查询文本
- **提取的认知特征（Extracted Cues）**：来自阶段一的标注特征列表

### 处理流程

#### 1. 动态提示工程（Dynamic Prompt Engineering）
根据提取的特征类型和当前查询，动态构建生成提示：

**提示结构**：
- **任务说明**：生成一个研究背景描述，帮助重排器识别相关文档
- **当前查询**：显示用户当前查询
- **特征说明**：解释三类特征的含义和使用方式
  - Sequential Memory：用于解析查询中的指代和隐含关系
  - Working Memory：反映当前会话的研究焦点
  - Long Explicit：提供研究领域背景
- **生成要求**：
  - 长度控制：200-300字符（可配置）
  - 格式：单一陈述句，从研究者视角描述
  - 保留所有技术术语和实体名称的原始形式
  - 整合领域背景和应用场景

#### 2. LLM生成（LLM Generation）
- **模型**：使用Qwen3-14B或类似的大语言模型
- **生成策略**：
  - 链式思考（Chain-of-Thought）：分步骤推理
    - Step 1: 识别关键术语（从查询中提取所有技术术语、实体、方法名）
    - Step 2: 确定研究领域（识别高级研究领域和应用场景）
    - Step 3: 智能使用提取特征（解析指代、理解隐含关系、提取领域上下文）
    - Step 4: 构建输出（组合用户视角、研究领域、关键术语）
  - 多次生成与质量评估：生成多个候选，根据长度、术语覆盖、结构、内容质量等维度评分，选择最佳候选

#### 3. 质量验证（Quality Validation）
- **长度检查**：确保在目标长度范围内（如200-300字符）
- **术语保留**：验证所有技术术语和实体名称被正确保留
- **结构完整性**：检查是否为完整的陈述句
- **相关性**：评估与查询和特征的相关性

### 输出
- **个性化研究画像（Personalized Profile）**：
  - 一段200-300字符的文本描述
  - 格式示例："Researcher in [domain] investigating [key terms] for [application/context]"
  - 整合了用户的研究领域、当前查询的关键术语、以及从历史中提取的上下文信息

---

## 阶段三：基于画像的重排（Profile-Based Reranking）

### 功能描述
使用个性化研究画像作为重排查询，对初始检索得到的候选文档进行重排，生成最终的Top-N推荐列表。

### 输入
- **候选文档（Candidate Papers）**：来自高召回检索阶段的文档列表（通常Top-100）
- **个性化画像（Personalized Profile）**：来自阶段二生成的研究背景描述

### 处理流程

#### 1. 重排输入构建（Reranking Input Construction）
**关键设计**：仅使用个性化画像作为重排查询，不包含原始查询

**输入格式**（以Jina-Reranker-v3为例）：
```
<Instruct>: Given a research topic description that captures a user's current investigation focus, 
determine if the following document is highly relevant to this research direction. 
The research description integrates the user's domain expertise with their current inquiry. 
Match the document against both the research domain and the specific technical focus described.

<Research Focus>: [Personalized Profile Text]

<Document>: [Document Title and Content]
```

**说明**：
- 指令（Instruction）：明确任务是从研究焦点角度评估文档相关性
- 研究焦点（Research Focus）：使用生成的个性化画像
- 文档（Document）：候选文档的标题和内容

#### 2. 融合评分（Fused Scoring）
- **重排模型**：使用Jina-Reranker-v3或其他神经重排模型
- **评分机制**：
  - 模型计算画像与每个文档的相关性分数
  - 分数反映文档与用户研究背景的匹配程度
  - 考虑领域相关性、技术焦点匹配、应用场景契合度

#### 3. 重排与排序（Reranking and Ranking）
- **排序**：根据相关性分数降序排列
- **截断**：选择Top-N文档（通常N=10）
- **输出格式**：包含文档ID、标题、文本内容、重排分数

### 输出
- **Top-N推荐列表（Top-N List）**：
  - 按相关性分数排序的文档列表
  - 每个文档包含：text_id, title, text, score
  - 这些文档与用户的研究背景和兴趣高度匹配

---

## 系统流程图

```
┌─────────────────────────────────────────────────────────────────┐
│                     Stage 1: Cognitive Feature Extraction        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Query Session                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │ Current Query│  │History Query 1│  │History Query 2│         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
│         │                  │                  │                 │
│         └──────────────────┴──────────────────┘                 │
│                            │                                    │
│                            ▼                                    │
│         ┌──────────────────────────────────────┐                │
│         │  Contextual Feature Distillation    │                │
│         │  ┌──────────────┐  ┌──────────────┐ │                │
│         │  │ Sequential   │  │   Focus      │ │                │
│         │  │    Cues      │  │    Cues      │ │                │
│         │  └──────────────┘  └──────────────┘ │                │
│         │  ┌──────────────┐                   │                │
│         │  │ Background   │                   │                │
│         │  │    Cues      │                   │                │
│         │  └──────────────┘                   │                │
│         └──────────────────────────────────────┘                │
│                            │                                    │
│                            ▼                                    │
│              Extracted Tagged Memory Features                   │
│              [SEQUENTIAL_MEMORY], [WORKING_MEMORY],            │
│              [LONG_EXPLICIT]                                    │
└─────────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│              Stage 2: Personalized Profile Generation          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Current Query + Extracted Features                             │
│                            │                                    │
│                            ▼                                    │
│         ┌──────────────────────────────────────┐                │
│         │   Dynamic Prompt Engineering         │                │
│         │   (Chain-of-Thought Instructions)    │                │
│         └──────────────────────────────────────┘                │
│                            │                                    │
│                            ▼                                    │
│         ┌──────────────────────────────────────┐                │
│         │         Large Language Model         │                │
│         │         (Qwen3-14B / Similar)        │                │
│         └──────────────────────────────────────┘                │
│                            │                                    │
│                            ▼                                    │
│              ┌──────────────────────────────┐                   │
│              │  Personalized Profile        │                   │
│              │  (200-300 characters)        │                   │
│              │  "Researcher in [domain]     │                   │
│              │   investigating [terms]..."   │                   │
│              └──────────────────────────────┘                   │
└─────────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│              Stage 3: Profile-Based Reranking                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────────┐         ┌──────────────────────────┐    │
│  │ Candidate Papers │         │ Personalized Profile     │    │
│  │  (Top-100 from   │         │  (from Stage 2)          │    │
│  │   Retrieval)     │         └──────────────────────────┘    │
│  └──────────────────┘                    │                    │
│         │                                 │                    │
│         │                                 │                    │
│         └────────────┬────────────────────┘                    │
│                      ▼                                          │
│         ┌──────────────────────────────────────┐                │
│         │      Fused Scoring                   │                │
│         │  (Profile + Document Relevance)      │                │
│         └──────────────────────────────────────┘                │
│                      │                                          │
│                      ▼                                          │
│         ┌──────────────────────────────────────┐                │
│         │         Reranker                      │                │
│         │    (Jina-Reranker-v3)                 │                │
│         └──────────────────────────────────────┘                │
│                      │                                          │
│                      ▼                                          │
│              ┌──────────────────────────┐                       │
│              │    Top-N List            │                       │
│              │  (Ranked by Relevance)   │                       │
│              └──────────────────────────┘                       │
└─────────────────────────────────────────────────────────────────┘
```

---

## 关键设计特点

### 1. 仅基于画像的重排策略
- **核心变化**：重排阶段**不使用原始查询**，仅使用个性化画像
- **优势**：
  - 画像已经整合了查询信息和历史上下文，避免了信息冗余
  - 画像提供了更丰富的领域背景，有助于理解文档的深层相关性
  - 减少了查询与画像之间的潜在冲突或不一致

### 2. 多时间尺度的认知建模
- **序列记忆**：捕获短期对话依赖（几轮对话内）
- **工作记忆**：捕获当前会话焦点（单次会话）
- **长期记忆**：捕获用户研究背景（跨会话）

### 3. 链式思考的画像生成
- 通过分步骤推理确保生成质量
- 明确处理指代解析、术语保留、领域整合等关键任务

### 4. 端到端的个性化流程
- 从原始查询到最终推荐，全程考虑用户个性化信息
- 三个阶段紧密衔接，信息流清晰

---

## 技术实现细节

### 阶段一技术栈
- **特征提取器**：KeyBERT（基于Qwen3-Embedding-0.6B）
- **记忆系统**：基于向量检索的认知记忆系统
- **引用解析**：基于规则和语义相似度的指代消解

### 阶段二技术栈
- **LLM API**：SiliconFlow API（Qwen3-14B）
- **生成策略**：Chain-of-Thought + 多次生成 + 质量评估
- **长度控制**：智能截断和长度验证

### 阶段三技术栈
- **重排模型**：Jina-Reranker-v3
- **输入格式**：Instruction + Research Focus + Document
- **评分方式**：神经网络的语义相关性分数

---

## 数据流总结

1. **输入**：查询会话（当前查询 + 历史查询）
2. **阶段一输出**：标注的认知特征（三类记忆特征）
3. **阶段二输出**：个性化研究画像（200-300字符文本）
4. **阶段三输入**：候选文档 + 个性化画像
5. **最终输出**：Top-N重排后的文档列表

---

## 可视化建议

### 布局建议
- **左侧垂直排列**：阶段一（上）和阶段三（下）
- **右侧占据**：阶段二（个性化画像生成）
- **箭头流向**：清晰显示数据从阶段一到阶段二到阶段三的流动

### 关键元素
- **阶段一**：突出三类特征提取（Sequential, Focus, Background）
- **阶段二**：突出LLM生成和Chain-of-Thought流程
- **阶段三**：突出"仅使用Profile"的设计，Candidate Papers和Profile汇聚到Fused Scoring

### 颜色建议
- **阶段一**：蓝色系（信息提取）
- **阶段二**：绿色系（生成与转换）
- **阶段三**：橙色/红色系（重排与输出）

